{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file://G%3A/_dev/hidden_path/arg-game/src/server/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log:\n      process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6HAAA,CAAA,eAAY,CAAC;IACf,KACE,uCAAyC;QAAC;QAAS;QAAS;KAAO;AACvE;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file://G%3A/_dev/hidden_path/arg-game/src/utils/booking-code.ts"],"sourcesContent":["import { prisma } from \"~/server/db\";\r\n\r\n// Characters to use for generating codes (excluding similar looking characters)\r\nexport const CODE_CHARS = \"23456789ABCDEFGHJKLMNPQRSTUVWXYZ\";\r\nexport const CODE_LENGTH = 6;\r\n\r\n/**\r\n * Generates a unique booking code for a team's game session\r\n * Format: XXXXXX (6 characters total)\r\n */\r\nexport async function generateUniqueBookingCode(): Promise<string> {\r\n    let attempts = 0;\r\n    const maxAttempts = 10;\r\n\r\n    while (attempts < maxAttempts) {\r\n        // Generate a random code\r\n        let code = \"\";\r\n        for (let i = 0; i < CODE_LENGTH; i++) {\r\n            code += CODE_CHARS.charAt(Math.floor(Math.random() * CODE_CHARS.length));\r\n        }\r\n\r\n        // Check if code exists\r\n        const existing = await prisma.booking.findUnique({\r\n            where: { code },\r\n        });\r\n\r\n        if (!existing) {\r\n            return code;\r\n        }\r\n\r\n        attempts++;\r\n    }\r\n\r\n    throw new Error(\"Could not generate unique booking code after multiple attempts\");\r\n}\r\n\r\n/**\r\n * Validates a booking code format.\r\n * Booking codes are uppercase alphanumeric strings of 6 characters.\r\n * Input is converted to uppercase before validation.\r\n */\r\nexport function isValidBookingCode(code: string): boolean {\r\n    const upperCode = code.toUpperCase();\r\n    return /^[A-Z0-9]{6}$/.test(upperCode);\r\n}\r\n\r\n/**\r\n * Formats a raw code string into the standard format (XXXXXX)\r\n * @throws Error if code contains invalid characters or length\r\n */\r\nexport function formatBookingCode(code: string): string {\r\n    // Convert to uppercase and remove any non-alphanumeric characters\r\n    const cleaned = code.toUpperCase().replace(/[^A-Z0-9]/g, \"\");\r\n\r\n    // Check if all characters are valid\r\n    const validChars = new RegExp(`^[${CODE_CHARS}]{${CODE_LENGTH}}$`);\r\n    if (!validChars.test(cleaned)) {\r\n        throw new Error(\"Code contains invalid characters or incorrect length\");\r\n    }\r\n\r\n    return cleaned;\r\n} "],"names":[],"mappings":";;;;;;;AAAA;;AAGO,MAAM,aAAa;AACnB,MAAM,cAAc;AAMpB,eAAe;IAClB,IAAI,WAAW;IACf,MAAM,cAAc;IAEpB,MAAO,WAAW,YAAa;QAC3B,yBAAyB;QACzB,IAAI,OAAO;QACX,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,IAAK;YAClC,QAAQ,WAAW,MAAM,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,WAAW,MAAM;QAC1E;QAEA,uBAAuB;QACvB,MAAM,WAAW,MAAM,qHAAA,CAAA,SAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC7C,OAAO;gBAAE;YAAK;QAClB;QAEA,IAAI,CAAC,UAAU;YACX,OAAO;QACX;QAEA;IACJ;IAEA,MAAM,IAAI,MAAM;AACpB;AAOO,SAAS,mBAAmB,IAAY;IAC3C,MAAM,YAAY,KAAK,WAAW;IAClC,OAAO,gBAAgB,IAAI,CAAC;AAChC;AAMO,SAAS,kBAAkB,IAAY;IAC1C,kEAAkE;IAClE,MAAM,UAAU,KAAK,WAAW,GAAG,OAAO,CAAC,cAAc;IAEzD,oCAAoC;IACpC,MAAM,aAAa,IAAI,OAAO,CAAC,EAAE,EAAE,WAAW,EAAE,EAAE,YAAY,EAAE,CAAC;IACjE,IAAI,CAAC,WAAW,IAAI,CAAC,UAAU;QAC3B,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO;AACX"}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file://G%3A/_dev/hidden_path/arg-game/src/app/api/bookings/%5Bcode%5D/reset/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"~/server/db\";\r\nimport { isValidBookingCode } from \"~/utils/booking-code\";\r\n\r\nexport async function POST(\r\n    request: Request,\r\n    context: { params: Promise<{ code: string }> }\r\n) {\r\n    try {\r\n        const { code } = await context.params;\r\n        const upperCode = code.toUpperCase();\r\n\r\n        if (!isValidBookingCode(upperCode)) {\r\n            return NextResponse.json(\r\n                { error: \"Invalid booking code format\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Find the booking and its instance\r\n        const booking = await prisma.booking.findUnique({\r\n            where: { code: upperCode },\r\n            include: {\r\n                instance: true,\r\n            },\r\n        });\r\n\r\n        if (!booking) {\r\n            return NextResponse.json(\r\n                { error: \"Booking not found\" },\r\n                { status: 404 }\r\n            );\r\n        }\r\n\r\n        if (!booking.instance) {\r\n            return NextResponse.json(\r\n                { error: \"No game instance found\" },\r\n                { status: 404 }\r\n            );\r\n        }\r\n\r\n        // Reset the game instance\r\n        const updatedInstance = await prisma.gameInstance.update({\r\n            where: { id: booking.instance.id },\r\n            data: {\r\n                currentPuzzleOrder: 1,\r\n                solvedPuzzles: null,\r\n                completedAt: null,\r\n            },\r\n        });\r\n\r\n        return NextResponse.json({ success: true, instance: updatedInstance });\r\n    } catch (error) {\r\n        console.error(\"Error resetting game progress:\", error);\r\n        return NextResponse.json(\r\n            { error: \"Failed to reset game progress\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n} "],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAClB,OAAgB,EAChB,OAA8C;IAE9C,IAAI;QACA,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,MAAM;QACrC,MAAM,YAAY,KAAK,WAAW;QAElC,IAAI,CAAC,CAAA,GAAA,iIAAA,CAAA,qBAAkB,AAAD,EAAE,YAAY;YAChC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,oCAAoC;QACpC,MAAM,UAAU,MAAM,qHAAA,CAAA,SAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC5C,OAAO;gBAAE,MAAM;YAAU;YACzB,SAAS;gBACL,UAAU;YACd;QACJ;QAEA,IAAI,CAAC,SAAS;YACV,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,IAAI,CAAC,QAAQ,QAAQ,EAAE;YACnB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,0BAA0B;QAC1B,MAAM,kBAAkB,MAAM,qHAAA,CAAA,SAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YACrD,OAAO;gBAAE,IAAI,QAAQ,QAAQ,CAAC,EAAE;YAAC;YACjC,MAAM;gBACF,oBAAoB;gBACpB,eAAe;gBACf,aAAa;YACjB;QACJ;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,UAAU;QAAgB;IACxE,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAgC,GACzC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}