{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file://G%3A/_dev/hidden_path/arg-game/src/server/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log:\n      process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6HAAA,CAAA,eAAY,CAAC;IACf,KACE,uCAAyC;QAAC;QAAS;QAAS;KAAO;AACvE;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file://G%3A/_dev/hidden_path/arg-game/src/utils/booking-code.ts"],"sourcesContent":["import { prisma } from \"~/server/db\";\r\n\r\n// Characters to use for generating codes (excluding similar looking characters)\r\nexport const CODE_CHARS = \"23456789ABCDEFGHJKLMNPQRSTUVWXYZ\";\r\nexport const CODE_LENGTH = 6;\r\n\r\n/**\r\n * Generates a unique booking code for a team's game session\r\n * Format: XXXXXX (6 characters total)\r\n */\r\nexport async function generateUniqueBookingCode(): Promise<string> {\r\n    let attempts = 0;\r\n    const maxAttempts = 10;\r\n\r\n    while (attempts < maxAttempts) {\r\n        // Generate a random code\r\n        let code = \"\";\r\n        for (let i = 0; i < CODE_LENGTH; i++) {\r\n            code += CODE_CHARS.charAt(Math.floor(Math.random() * CODE_CHARS.length));\r\n        }\r\n\r\n        // Check if code exists\r\n        const existing = await prisma.booking.findUnique({\r\n            where: { code },\r\n        });\r\n\r\n        if (!existing) {\r\n            return code;\r\n        }\r\n\r\n        attempts++;\r\n    }\r\n\r\n    throw new Error(\"Could not generate unique booking code after multiple attempts\");\r\n}\r\n\r\n/**\r\n * Validates a booking code format.\r\n * Booking codes are uppercase alphanumeric strings of 6 characters.\r\n * Input is converted to uppercase before validation.\r\n */\r\nexport function isValidBookingCode(code: string): boolean {\r\n    const upperCode = code.toUpperCase();\r\n    return /^[A-Z0-9]{6}$/.test(upperCode);\r\n}\r\n\r\n/**\r\n * Formats a raw code string into the standard format (XXXXXX)\r\n * @throws Error if code contains invalid characters or length\r\n */\r\nexport function formatBookingCode(code: string): string {\r\n    // Convert to uppercase and remove any non-alphanumeric characters\r\n    const cleaned = code.toUpperCase().replace(/[^A-Z0-9]/g, \"\");\r\n\r\n    // Check if all characters are valid\r\n    const validChars = new RegExp(`^[${CODE_CHARS}]{${CODE_LENGTH}}$`);\r\n    if (!validChars.test(cleaned)) {\r\n        throw new Error(\"Code contains invalid characters or incorrect length\");\r\n    }\r\n\r\n    return cleaned;\r\n} "],"names":[],"mappings":";;;;;;;AAAA;;AAGO,MAAM,aAAa;AACnB,MAAM,cAAc;AAMpB,eAAe;IAClB,IAAI,WAAW;IACf,MAAM,cAAc;IAEpB,MAAO,WAAW,YAAa;QAC3B,yBAAyB;QACzB,IAAI,OAAO;QACX,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,IAAK;YAClC,QAAQ,WAAW,MAAM,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,WAAW,MAAM;QAC1E;QAEA,uBAAuB;QACvB,MAAM,WAAW,MAAM,qHAAA,CAAA,SAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC7C,OAAO;gBAAE;YAAK;QAClB;QAEA,IAAI,CAAC,UAAU;YACX,OAAO;QACX;QAEA;IACJ;IAEA,MAAM,IAAI,MAAM;AACpB;AAOO,SAAS,mBAAmB,IAAY;IAC3C,MAAM,YAAY,KAAK,WAAW;IAClC,OAAO,gBAAgB,IAAI,CAAC;AAChC;AAMO,SAAS,kBAAkB,IAAY;IAC1C,kEAAkE;IAClE,MAAM,UAAU,KAAK,WAAW,GAAG,OAAO,CAAC,cAAc;IAEzD,oCAAoC;IACpC,MAAM,aAAa,IAAI,OAAO,CAAC,EAAE,EAAE,WAAW,EAAE,EAAE,YAAY,EAAE,CAAC;IACjE,IAAI,CAAC,WAAW,IAAI,CAAC,UAAU;QAC3B,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO;AACX"}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file://G%3A/_dev/hidden_path/arg-game/src/app/api/bookings/%5Bcode%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"~/server/db\";\r\nimport { isValidBookingCode } from \"~/utils/booking-code\";\r\nimport { type Player } from \"~/types/team\";\r\n\r\n// Define the response interface\r\ninterface BookingResponse {\r\n    booking: {\r\n        id: number;\r\n        code: string;\r\n        teamId: number;\r\n        gameId: number;\r\n        startTime: string | null;\r\n        expiresAt: string | null;\r\n        voucher: string | null;\r\n        paid: boolean;\r\n        notes: string | null;\r\n        team: {\r\n            id: number;\r\n            name: string;\r\n            players: Player[];\r\n        };\r\n        game: {\r\n            id: number;\r\n            name: string;\r\n            description: string;\r\n            puzzles: {\r\n                id: number;\r\n                order: number;\r\n                question: string;\r\n                type: string;\r\n                choices?: {\r\n                    id: string;\r\n                    text: string;\r\n                }[];\r\n                locationData?: string;\r\n                imageUrl?: string;\r\n            }[];\r\n        };\r\n        instance: {\r\n            id: number;\r\n            currentPuzzleOrder: number | null;\r\n        } | null;\r\n    };\r\n}\r\n\r\nexport async function GET(\r\n    request: Request,\r\n    { params }: { params: Promise<{ code: string }> }\r\n) {\r\n    try {\r\n        const { code } = await params;\r\n        const upperCode = code.toUpperCase();\r\n\r\n        if (!isValidBookingCode(upperCode)) {\r\n            return NextResponse.json(\r\n                { error: \"Invalid booking code format\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const result = await prisma.booking.findUnique({\r\n            where: { code: upperCode },\r\n            include: {\r\n                team: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        players: true,\r\n                    },\r\n                },\r\n                game: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        description: true,\r\n                        puzzles: {\r\n                            select: {\r\n                                id: true,\r\n                                order: true,\r\n                                question: true,\r\n                                type: true,\r\n                                choices: true,\r\n                                locationData: true,\r\n                                imageUrl: true,\r\n                            },\r\n                            orderBy: {\r\n                                order: 'asc',\r\n                            },\r\n                        },\r\n                    },\r\n                },\r\n                instance: {\r\n                    select: {\r\n                        id: true,\r\n                        currentPuzzleOrder: true,\r\n                    },\r\n                },\r\n            },\r\n        });\r\n\r\n        if (!result) {\r\n            return NextResponse.json(\r\n                { error: \"Booking not found\" },\r\n                { status: 404 }\r\n            );\r\n        }\r\n\r\n        const response: BookingResponse = {\r\n            booking: {\r\n                ...result,\r\n                startTime: result.startTime?.toISOString() ?? null,\r\n                expiresAt: result.expiresAt?.toISOString() ?? null,\r\n                team: {\r\n                    ...result.team,\r\n                    players: result.team.players ? JSON.parse(result.team.players as string) : [],\r\n                },\r\n            },\r\n        };\r\n\r\n        return NextResponse.json(response);\r\n    } catch (error) {\r\n        console.error(\"Error fetching booking:\", error);\r\n        return NextResponse.json(\r\n            { error: \"Failed to fetch booking data\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\nexport async function PATCH(\r\n    request: Request,\r\n    { params }: { params: Promise<{ code: string }> }\r\n) {\r\n    try {\r\n        const { code } = await params;\r\n        const upperCode = code.toUpperCase();\r\n\r\n        if (!isValidBookingCode(upperCode)) {\r\n            return NextResponse.json(\r\n                { error: \"Invalid booking code format\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const body = await request.json() as {\r\n            teamId: number;\r\n            gameId: number;\r\n            startTime: string | null;\r\n            expiresAt: string | null;\r\n            voucher: string | null;\r\n            paid: boolean;\r\n            notes: string | null;\r\n        };\r\n\r\n        const booking = await prisma.booking.update({\r\n            where: { code: upperCode },\r\n            data: {\r\n                team: { connect: { id: body.teamId } },\r\n                game: { connect: { id: body.gameId } },\r\n                startTime: body.startTime ? new Date(body.startTime) : null,\r\n                expiresAt: body.expiresAt ? new Date(body.expiresAt) : null,\r\n                voucher: body.voucher,\r\n                paid: body.paid,\r\n                notes: body.notes,\r\n            },\r\n            include: {\r\n                team: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        players: true,\r\n                    },\r\n                },\r\n                game: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                    },\r\n                },\r\n            },\r\n        });\r\n\r\n        return NextResponse.json({\r\n            booking: {\r\n                ...booking,\r\n                team: {\r\n                    ...booking.team,\r\n                    players: booking.team.players ? JSON.parse(booking.team.players as string) : [],\r\n                },\r\n            },\r\n        });\r\n    } catch (error) {\r\n        console.error(\"Error updating booking:\", error);\r\n        return NextResponse.json(\r\n            { error: \"Failed to update booking\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\nexport async function DELETE(\r\n    request: Request,\r\n    { params }: { params: Promise<{ code: string }> }\r\n) {\r\n    try {\r\n        const { code } = await params;\r\n        const upperCode = code.toUpperCase();\r\n\r\n        if (!isValidBookingCode(upperCode)) {\r\n            return NextResponse.json(\r\n                { error: \"Invalid booking code format\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        await prisma.booking.delete({\r\n            where: { code: upperCode },\r\n        });\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        console.error(\"Error deleting booking:\", error);\r\n        return NextResponse.json(\r\n            { error: \"Failed to delete booking\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 322, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}